# k6-cloud-openapi-client

**Code generated Go client for the [Grafana Cloud k6 REST API v6](https://grafana.com/docs/grafana-cloud/testing/k6/reference/cloud-rest-api/v6/).**

_Code generated from the OpenAPI specification that can be found at https://api.k6.io/cloud/v6/openapi._

## Getting started

You can find detailed docs about how to initialize and use the client in the [client documentation](./k6/README.md).

If you want to see a working example, navigate to the [examples](./examples) directory.

## Code generation

### Requirements

> [!NOTE]
> Although the `openapi-generator` is the only tool really required, it's strongly recommended to have `goimports` 
> installed as well, because the code generated isn't correctly formatted, and sometimes it even has some errors with
> non-used imports.

The Go code present on this repository has been generated with [openapi-generator](https://openapi-generator.tech/).

You can find further details about how to install it [here](https://openapi-generator.tech/docs/installation).

### Retrieve the schema

Once you have the `openapi-generator` installed, the first step is to retrieve the schema, in case
the `schema.yaml` file stored in the repository is no longer up-to-date.

You can download it from: https://api.k6.io/cloud/v6/openapi.

### Generate the client

As of now, the client is generated with the following command:

```bash
openapi-generator-cli generate -i schema.yaml -g go -o ./k6 --git-user-id grafana --git-repo-id k6-cloud-openapi-client --package-name k6 -p isGoSubmodule=true -p disallowAdditionalPropertiesIfNotPresent=false -p withGoMod=false -t ./templates/go
```

Once the client is generated, you need to run `goimports`, cause the code generated isn't correctly formatted, 
and sometimes it even has some errors with non-used imports:

```bash
find k6 -name \*.go -exec goimports -w {} \;
```

### Additional information

#### GitHub Action

In the Grafana's [`shared-workflows` repository](https://github.com/grafana/shared-workflows), there is a GitHub Action
named [`generate-openapi-clients`](https://github.com/grafana/shared-workflows/tree/main/actions/generate-openapi-clients),
which is almost equivalent to the command above, but meant to be executed within a GitHub workflow.

In the future, we might explore the use of that action to "automate" the generation of the client. That's why we use
the [templates/go](./templates/go), to keep the code generated consistent with the one generated by the action, and
thus consistent with other code generated clients within the company.